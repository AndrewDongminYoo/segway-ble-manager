<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Home - Postman Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/ionicons.min.css" />
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css" />
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css" />
  </head>
  <body>
    <input type="checkbox" id="nav-trigger" class="nav-trigger" />
    <label for="nav-trigger" class="navicon-button x">
      <div class="navicon"></div>
    </label>

    <label for="nav-trigger" class="overlay"></label>

    <nav>
      <h2><a href="index.html">Home</a></h2>
      <h3>Global</h3>
      <ul>
        <li><a href="global.html#BLEProvider">BLEProvider</a></li>
        <li><a href="global.html#EventContext">EventContext</a></li>
        <li><a href="global.html#SegwayBleManagerModule">SegwayBleManagerModule</a></li>
        <li><a href="global.html#Spec">Spec</a></li>
        <li><a href="global.html#eventReceiver">eventReceiver</a></li>
        <li><a href="global.html#initialize">initialize</a></li>
        <li><a href="global.html#ioTConnect">ioTConnect</a></li>
        <li><a href="global.html#ioTDisconnect">ioTDisconnect</a></li>
        <li><a href="global.html#lockScooter">lockScooter</a></li>
        <li><a href="global.html#logger">logger</a></li>
        <li><a href="global.html#openBatteryCover">openBatteryCover</a></li>
        <li><a href="global.html#openSaddle">openSaddle</a></li>
        <li><a href="global.html#openTailBox">openTailBox</a></li>
        <li><a href="global.html#queryIoTInfo">queryIoTInfo</a></li>
        <li><a href="global.html#queryVehicleInfo">queryVehicleInfo</a></li>
        <li><a href="global.html#registerListener">registerListener</a></li>
        <li><a href="global.html#unLockScooter">unLockScooter</a></li>
        <li><a href="global.html#validateKeyCode">validateKeyCode</a></li>
        <li><a href="global.html#validateRegex">validateRegex</a></li>
        <li><a href="global.html#validateScooter">validateScooter</a></li>
      </ul>
    </nav>

    <div id="main">
      <section class="readme">
        <article>
          <h1>@dongminyu/segway-ble-manager</h1>
          <p>
            <code>react-native-segway-ble-manager</code> is a React Native library for managing Bluetooth Low Energy
            (BLE) connections with Segway devices. <code>react-native-segway-ble-manager</code> provides an easy-to-use
            API for connecting to and communicating with Segway devices over BLE. The library supports both Android and
            iOS platforms and includes features such as device discovery, connection management, and data transfer. With
            <code>react-native-segway-ble-manager</code>, developers can easily integrate Segway device control into
            their React Native applications.
          </p>
          <h2>Project Overview</h2>
          <p>
            This project is an extreme enhancement of a previously existing native module at our company. The previous
            module imported all methods directly from an imported module. Additionally, it wasn't type-safe, causing
            some errors. So I tried improving the module, and created a new native module that uses the new architecture
            of React Native. This module allows developers to connect to Segway vehicles, query and manipulate vehicle
            information, and subscribe to events generated by the device.
          </p>
          <h2>Installation</h2>
          <pre class="prettyprint source lang-shell"><code># if you use pure npm (what a classic!),
npm install @dongminyu/react-native-segway-ble-manager
</code></pre>
          <pre
            class="prettyprint source lang-shell"
          ><code># or if you prefer to use Yarn (I love it's parallel install feature),
yarn add @dongminyu/react-native-segway-ble-manager
</code></pre>
          <pre class="prettyprint source lang-shell"><code># or if you use pnpm (it's fast and efficient),
pnpm add @dongminyu/react-native-segway-ble-manager
</code></pre>
          <h2>Permission Setting</h2>
          <ul>
            <li>
              <p>in iOS</p>
              <pre
                class="prettyprint source lang-xml"
              ><code>    &lt;!-- iOS 13 and newer, include the `NSBluetoothAlwaysUsageDescription` -->
    &lt;key>NSBluetoothAlwaysUsageDescription&lt;/key>
    &lt;string>Use Bluetooth when it needs to control the scooter&lt;/string>
    &lt;!-- iOS 12 and earlier, include `NSBluetoothPeripheralUsageDescription` -->
    &lt;key>NSBluetoothPeripheralUsageDescription&lt;/key>
    &lt;string>Use Bluetooth peripherals to control the scooter&lt;/string>
    &lt;key>NSLocationWhenInUseUsageDescription&lt;/key>
    &lt;string>Accesses location data to measure the distance&lt;/string>
</code></pre>
            </li>
            <li>
              <p>Android 설정</p>
              <pre
                class="prettyprint source lang-xml"
              ><code>&lt;uses-permission android:name=&quot;android.permission.ACCESS_FINE_LOCATION&quot; />
&lt;uses-permission android:name=&quot;android.permission.ACCESS_COARSE_LOCATION&quot; />
&lt;uses-permission android:name=&quot;android.permission.BLUETOOTH&quot; />
&lt;uses-permission android:name=&quot;android.permission.BLUETOOTH_ADMIN&quot; />
&lt;uses-feature
  android:name=&quot;android.hardware.bluetooth_le&quot;
  android:required=&quot;true&quot; />
</code></pre>
            </li>
          </ul>
          <h2>Simple Example Code</h2>
          <p>
            Here's an example code snippet that demonstrates how to use the
            <code>react-native-segway-ble-manager</code> module to connect to a Segway vehicle, unlock it, and then
            disconnect from it:
          </p>
          <pre class="prettyprint source lang-typescript"><code>import {
  ioTConnect,
  ioTDisconnect,
  initialize,
  unLockScooter,
  lockScooter,
  openBatteryCover,
  openSaddle,
  openTailBox,
  queryVehicleInfo,
  queryIoTInfo,
} from '@dongminyu/segway-ble-manager';

const BLE_INIT_SECRET_KEY = 'MY_SECRET_KEY';
const BLE_INIT_OPERATION_CODE = 'MY_OPERATOR_CODE';
const deviceMac = 'DEVICE_MAC_ADDRESS';
const deviceKey = 'DEVICE_KEY';
const iotImei = 'IOT_IMEI';

React.useEffect(() => {
  init(BLE_INIT_SECRET_KEY, BLE_INIT_OPERATION_CODE, true);
  // get required permissions
  getRequiredPermissions();
}, []);

React.useEffect(() => {
  let intervalId: number;
  if (timer > 0) {
    intervalId = setInterval(() => {
      setTimer(timer - 1);
    }, 1000);
  }
  return () => {
    setLoading(false);
    return clearInterval(intervalId);
  };
}, [timer]);
</code></pre>
          <p>
            In this example, we first import the necessary modules, including the <code>Spec</code> interface from the
            <code>react-native-segway-ble-manager</code> module. We then create a new instance of the
            <code>NativeEventEmitter</code> class, passing in the <code>BleManager</code> module as an argument.
          </p>
          <p>
            Next, we define some configuration variables, such as the <code>secretKey</code>, <code>operatorCode</code>,
            <code>deviceMac</code>, <code>deviceKey</code>, and <code>iotImei</code>. We then initialize the
            <code>BleManager</code> module, passing in the <code>secretKey</code>, <code>operatorCode</code>, and a
            boolean value indicating whether to use debug mode.
          </p>
          <p>
            Once the <code>BleManager</code> is initialized, we call the <code>connect</code> method, passing in the
            <code>deviceMac</code>, <code>deviceKey</code>, and <code>iotImei</code>. We then define two event
            listeners, one for when the Segway vehicle is connected (<code>onConnected</code>), and one for when it is
            disconnected (<code>onDisconnected</code>).
          </p>
          <p>
            When the Segway vehicle is connected, we call the <code>unLock</code> method to unlock it. Once it is
            unlocked, we log a message to the console, and then call the <code>disconnect</code> method to disconnect
            from the vehicle.
          </p>
          <p>
            Finally, when the vehicle is disconnected, we log another message to the console and remove the event
            listeners to prevent memory leaks.
          </p>
          <p>
            This is just a simple example, but it should give you an idea of how the
            <code>react-native-segway-ble-manager</code> module can be used to connect to and control a Segway vehicle.
          </p>
          <h2>Type Definition and Backward Compatibility</h2>
          <p>
            The New Architecture actually provides high-performance native modules that are supported by React Native
            version 0.69 and above, but cannot be imported from old-versioned environments. To compensate for this,
            we've prepared some backward compatibility settings.
          </p>
          <p>
            This is a description of how we implemented them, and is not a requirement to use the modules. However, the
            New Architecture (Fabric, TurboModule) is Facebook's answer to various technical performance requests from
            the developers of React Native, so it is certain that more application projects and ReactNative libraries
            will be developed using it in the future.
          </p>
          <pre class="prettyprint source lang-typescript"><code>/// index.tsx
const isTurboModuleEnabled = global.__turboModuleProxy != null;

const SegwayBleManagerModule = isTurboModuleEnabled
  ? require('./NativeSegwayBleManager').default
  : NativeModules.SegwayBleManager;
</code></pre>
          <p>
            The above Typescript code is part of the code that bridges to the JavaScript application. It checks to see
            if turboModuleProxy is declared as a property of the Global variable (it's a double underbar variable that
            JavaScript doesn't explicitly declare; it's injected from the C++ module), checks to see if the application
            has New Architecture enabled, and if so, it takes the form of fetching the module that extends TurboModule
            by index from NativeModules, otherwise. There is a difference in performance, but all other behavior and
            data types match.
          </p>
          <pre class="prettyprint source lang-groovy"><code>android {
   sourceSets {
      main {
         jniLibs.srcDirs += [&quot;lib&quot;]
         //noinspection GroovyImplicitNullArgumentCall
         if (isNewArchitectureEnabled()) {
            java.srcDirs += [
               &quot;src/newarch&quot;,
               // This is needed to build Kotlin project with NewArch enabled
               &quot;${project.buildDir}/generated/source/codegen/java&quot;
            ]
         } else {
            java.srcDirs += [&quot;src/oldarch&quot;]
         }
      }
   }
}
</code></pre>
          <p>
            The code above is part of the Android build script file. isNewArchitectureEnabled checks to see if the new
            architecture variable is set to true from the environment variables, and then imports the NativeModuleSpec
            abstract class from the new arch directory in the src folder and the configuration files from
            ReactNativeCodeGen. If it returns false, the abstract classes in old arch declared by the developer directly
            are imported. The two classes have exactly the same name and key properties, but the internal implementation
            differs from the turbo module.
          </p>
          <pre class="prettyprint source lang-diagram"><code>android
├─ build.gradle
├─ gradle.properties
└─ src
   ├─ main
   │  ├─ AndroidManifest.xml
   │  ├─ java
   │  │  └─ com
   │  │    └─ andrew
   │  │       └─ segwayBleManager
   │  │        ├─ SegwayBleManagerModule.kt
   │  │        └─ SegwayBleManagerPackage.kt
   │  └─ newArch
   │      └─ SegwayBleManagerSpec.kt
   └──── oldArch
          └─ SegwayBleManagerSpec.kt
/// no need to think about to implement which class.
</code></pre>
          <p>
            The diagram above represents the actual structure of that directory. Both interfaces have the name
            SegwayBleManagerSpec.kt and depending on your setup, SegwayBleManagerModule.kt is imported with just a
            simple class name.
          </p>
          <h2>Vehicle &amp; IoT Module Status</h2>
          <p>
            This code is written in TypeScript and defines several interfaces for a vehicle's information and an IoT
            device's information. It also includes an enumeration for supported event names.
          </p>
          <p>
            The <code>Scooter</code> interface defines the properties for a scooter, such as its number, device MAC
            address, device key, and IMEI.
          </p>
          <pre class="prettyprint source lang-typescript"><code>export interface Scooter {
  number: string;
  deviceMac: string;
  deviceKey: string;
  iotImei: string;
}
</code></pre>
          <p>
            The <code>VehicleInfo</code> interface defines the properties for a vehicle's information, such as the
            percentage value of battery, speed mode, current speed, total range, and remaining range. It also includes
            some deprecated properties that are available in Android but will be deprecated in Java and don't exist in
            iOS. These deprecated properties are replaced by new properties such as <code>powerPercent</code> and
            <code>speedMode</code>.
          </p>
          <pre class="prettyprint source lang-typescript"><code>export interface VehicleInfo {
  powerPercent: number;
  speedMode: number;
  currentSpeed: number;
  totalRange: number;
  remainingRange: number;
}
</code></pre>
          <p>
            The <code>IoTInformation</code> interface defines the properties for an IoT device's information, such as
            low and high voltage of the battery, power status, and version numbers. It also includes some deprecated
            properties that will be deprecated in Java or iOS and are replaced by new properties such as
            <code>majorVersionNumber</code>, <code>minorVersionNumber</code>, and <code>updateTimes</code>.
          </p>
          <pre class="prettyprint source lang-typescript"><code>export interface IoTInformation {
  lowBatteryVoltage: number;
  highBatteryVoltage: number;
  powerStatus: number;
  majorVersionNumber: number;
  minorVersionNumber: number;
  versionRevisions: number;
  modifiedTimes: number;
  updateTimes: number;
  isLocked: boolean;
  voltage: number;
}
</code></pre>
          <p>
            Finally, the <code>EventNames</code> enumeration defines the supported event names, which must be the same
            as the native module's event names.
          </p>
          <pre class="prettyprint source lang-typescript"><code>export enum Events {
  CONNECT = 'ConnectResult',
  DISCONNECT = 'DisconnectResult',
  INITIALIZE = 'InitializeResult',
  IOT_INFO = 'IoTInfoResult',
  LOCK = 'LockResult',
  OPEN_COVER = 'OpenCoverResult',
  OPEN_SADDLE = 'OpenSaddleResult',
  OPEN_TAIL_BOX = 'OpenTailBoxResult',
  UNLOCK = 'UnlockResult',
  VEHICLE_INFO = 'VehicleInfoResult',
}
</code></pre>
          <h2>Detail of Interfaces</h2>
          <p>The module's interface consists of the following methods:</p>
          <h3><code>getConstants()</code></h3>
          <p>This method returns a constant object with the following properties:</p>
          <ul>
            <li><code>supportedEvents</code>: an array of supported event types</li>
            <li><code>moduleName</code>: the name of the module</li>
          </ul>
          <h3><code>init(secretKey: string, operatorCode: string, isDebug: boolean): Promise&lt;boolean&gt;</code></h3>
          <p>
            This method initializes the module with the secret key, operator code, and a flag to indicate whether the
            module should run in debug mode. It returns a promise that resolves to a boolean value indicating whether
            initialization was successful.
          </p>
          <h3><code>connect(deviceMac: string, deviceKey: string, iotImei: string): void</code></h3>
          <p>
            This method establishes a connection to the Segway vehicle with the specified MAC address, device key, and
            IoT IMEI.
          </p>
          <h3><code>disconnect(): Promise&lt;boolean&gt;</code></h3>
          <p>
            This method disconnects from the Segway vehicle and returns a promise that resolves to a boolean value
            indicating whether disconnection was successful.
          </p>
          <h3><code>unLock(): Promise&lt;boolean&gt;</code></h3>
          <p>
            This method unlocks the Segway vehicle and returns a promise that resolves to a boolean value indicating
            whether unlocking was successful.
          </p>
          <h3><code>lock(): Promise&lt;boolean&gt;</code></h3>
          <p>
            This method locks the Segway vehicle and returns a promise that resolves to a boolean value indicating
            whether locking was successful.
          </p>
          <h3><code>openBatteryCover(): Promise&lt;boolean&gt;</code></h3>
          <p>
            This method opens the battery cover of the Segway vehicle and returns a promise that resolves to a boolean
            value indicating whether the operation was successful.
          </p>
          <h3><code>openSaddle(): Promise&lt;boolean&gt;</code></h3>
          <p>
            This method opens the saddle of the Segway vehicle and returns a promise that resolves to a boolean value
            indicating whether the operation was successful.
          </p>
          <h3><code>openTailBox(): Promise&lt;boolean&gt;</code></h3>
          <p>
            This method opens the tail box of the Segway vehicle and returns a promise that resolves to a boolean value
            indicating whether the operation was successful.
          </p>
          <h3><code>queryVehicleInformation(listener): void</code></h3>
          <p>
            This method queries the Segway vehicle for information about the device, such as the firmware version,
            serial number, and battery level.
          </p>
          <h3><code>queryIoTInformation(listener): void</code></h3>
          <p>
            This method queries the Segway vehicle for IoT information, such as the device's network status, signal
            strength, and IMEI.
          </p>
          <h2>Contributing</h2>
          <p>
            See the <a href="CONTRIBUTING.md">contributing guide</a> to learn how to contribute to the repository and
            the development workflow.
          </p>
          <h2>License</h2>
          <p>MIT</p>
          <hr />
          <p>
            Made with <a href="https://github.com/callstack/react-native-builder-bob">create-react-native-library</a>
          </p>
        </article>
      </section>
    </div>

    <br class="clear" />

    <footer>Documentation generated at Wed Apr 12 2023 15:56:58 GMT+0900 (Korean Standard Time)</footer>

    <script>
      prettyPrint();
    </script>
    <script src="scripts/linenumber.js"></script>
  </body>
</html>
